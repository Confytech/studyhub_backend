<!DOCTYPE html>
<html>
<head>
  <title>Quiz</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    label { display: block; margin: 5px 0; }
  </style>
</head>
<body>

<h1 id="question">Loading...</h1>

<form id="quiz-form">
  <label><input type="radio" name="option" value="A"> <span id="a"></span></label>
  <label><input type="radio" name="option" value="B"> <span id="b"></span></label>
  <label><input type="radio" name="option" value="C"> <span id="c"></span></label>
  <label><input type="radio" name="option" value="D"> <span id="d"></span></label>
  <button type="submit">Submit</button>
</form>

<p id="result"></p>

<script>
const API = "http://127.0.0.1:8000/api";
const token = localStorage.getItem("access");
const params = new URLSearchParams(window.location.search);
const quizId = params.get("id");

fetch(`${API}/study/lessons/`, {
  headers: { Authorization: `Bearer ${token}` }
})
.then(res => res.json())
.then(lessons => {
  for (const lesson of lessons) {
    const quiz = lesson.quizzes.find(q => q.id == quizId);
    if (quiz) {
      document.getElementById("question").textContent = quiz.question;
      document.getElementById("a").textContent = quiz.option_a;
      document.getElementById("b").textContent = quiz.option_b;
      document.getElementById("c").textContent = quiz.option_c;
      document.getElementById("d").textContent = quiz.option_d;
    }
  }
});

document.getElementById("quiz-form").addEventListener("submit", e => {
  e.preventDefault();
  const selected = document.querySelector("input[name='option']:checked");
  if (!selected) return alert("Select an option");

  fetch(`${API}/study/quizzes/${quizId}/submit/`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${token}`
    },
    body: JSON.stringify({ selected_option: selected.value })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("result").textContent =
      data.is_correct ? "✅ Correct!" : "❌ Wrong!";
  });
});
</script>

</body>
</html>

